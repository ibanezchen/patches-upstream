From 7c7d00477dc855b712b29e5d1c4fb859170bab28 Mon Sep 17 00:00:00 2001
From: Patrick Bellasi <patrick.bellasi@arm.com>
Date: Mon, 22 Jun 2015 13:51:07 +0100
Subject: [PATCH 33/38] DEBUG: schedtune: add tracepoint for CPU boost signal

Change-Id: I02747984be22093d6c4e7a04f43cdd8adea13bd4
Signed-off-by: Patrick Bellasi <patrick.bellasi@arm.com>
---
 include/trace/events/sched.h | 27 +++++++++++++++++++++++++++
 kernel/sched/fair.c          |  2 ++
 2 files changed, 29 insertions(+)

diff --git a/include/trace/events/sched.h b/include/trace/events/sched.h
index a081746..b6844e1 100644
--- a/include/trace/events/sched.h
+++ b/include/trace/events/sched.h
@@ -706,6 +706,33 @@ TRACE_EVENT(sched_boost_task,
 		  __entry->margin)
 );
 
+/*
+ * Tracepoint for accounting CPU  boosted utilization
+ */
+TRACE_EVENT(sched_boost_cpu,
+
+	TP_PROTO(int cpu, unsigned long usage, unsigned long margin),
+
+	TP_ARGS(cpu, usage, margin),
+
+	TP_STRUCT__entry(
+		__field( int,		cpu			)
+		__field( unsigned long,	usage			)
+		__field( unsigned long,	margin			)
+	),
+
+	TP_fast_assign(
+		__entry->cpu	= cpu;
+		__entry->usage	= usage;
+		__entry->margin	= margin;
+	),
+
+	TP_printk("cpu=%d usage=%lu margin=%lu",
+		  __entry->cpu,
+		  __entry->usage,
+		  __entry->margin)
+);
+
 #endif /* _TRACE_SCHED_H */
 
 /* This part must be outside protection */
diff --git a/kernel/sched/fair.c b/kernel/sched/fair.c
index 2b44124..ab7acca 100644
--- a/kernel/sched/fair.c
+++ b/kernel/sched/fair.c
@@ -5494,6 +5494,8 @@ get_boosted_cpu_usage(int cpu)
 	usage = get_cpu_usage(cpu);
 	margin = schedtune_cpu_margin(cpu, usage);
 
+	trace_sched_boost_cpu(cpu, usage, margin);
+
 	usage += margin;
 	return usage;
 }
-- 
1.9.1


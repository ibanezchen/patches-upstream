From 7eb8c5f53487a357ea2d25451c3b29be27d34a97 Mon Sep 17 00:00:00 2001
From: "freedom.tan" <freedom.tan@mediatek.com>
Date: Thu, 21 May 2015 12:36:33 +0800
Subject: [PATCH 6/6] fixed dts and other naming problems

---
 arch/arm64/boot/dts/mediatek/mt8173.dtsi | 62 ++++++++++++++++++++++++++++----
 drivers/i2c/busses/i2c-mt65xx.c          | 12 +++----
 2 files changed, 61 insertions(+), 13 deletions(-)

diff --git a/arch/arm64/boot/dts/mediatek/mt8173.dtsi b/arch/arm64/boot/dts/mediatek/mt8173.dtsi
index c9839b4..4ae5531 100644
--- a/arch/arm64/boot/dts/mediatek/mt8173.dtsi
+++ b/arch/arm64/boot/dts/mediatek/mt8173.dtsi
@@ -127,7 +127,7 @@
 			     (GIC_CPU_MASK_SIMPLE(4) | IRQ_TYPE_LEVEL_LOW)>;
 	};
 
-	 pmu {
+	pmu {
 		compatible = "arm,armv8-pmuv3";
 		interrupts = <GIC_SPI 60 IRQ_TYPE_LEVEL_HIGH>,
 			<GIC_SPI 61 IRQ_TYPE_LEVEL_HIGH>,
@@ -158,7 +158,7 @@
 				<0 0x11000100 0 0x80>;
 			interrupts = <GIC_SPI 76 IRQ_TYPE_LEVEL_LOW>;
 			clock-div = <16>;
-			clocks = <&pericfg PERI_I2C2>, <&pericfg PERI_AP_DMA>;
+			clocks = <&pericfg CLK_PERI_I2C2>, <&pericfg CLK_PERI_AP_DMA>;
 			clock-names = "main", "dma";
 		};
 
@@ -168,7 +168,7 @@
 				<0 0x11000180 0 0x80>;
 			interrupts = <GIC_SPI 77 IRQ_TYPE_LEVEL_LOW>;
 			clock-div = <16>;
-			clocks = <&pericfg PERI_I2C2>, <&pericfg PERI_AP_DMA>;
+			clocks = <&pericfg CLK_PERI_I2C2>, <&pericfg CLK_PERI_AP_DMA>;
 			clock-names = "main", "dma";
 		};
 
@@ -178,7 +178,7 @@
 				<0 0x11000200 0 0x80>;
 			interrupts = <GIC_SPI 78 IRQ_TYPE_LEVEL_LOW>;
 			clock-div = <16>;
-			clocks = <&pericfg PERI_I2C2>, <&pericfg PERI_AP_DMA>;
+			clocks = <&pericfg CLK_PERI_I2C2>, <&pericfg CLK_PERI_AP_DMA>;
 			clock-names = "main", "dma";
 		};
 
@@ -188,7 +188,7 @@
 				<0 0x11000280 0 0x80>;
 			interrupts = <GIC_SPI 79 IRQ_TYPE_LEVEL_LOW>;
 			clock-div = <16>;
-			clocks = <&pericfg PERI_I2C3>, <&pericfg PERI_AP_DMA>;
+			clocks = <&pericfg CLK_PERI_I2C3>, <&pericfg CLK_PERI_AP_DMA>;
 			clock-names = "main", "dma";
 		};
 
@@ -198,7 +198,7 @@
 				<0 0x11000300 0 0x80>;
 			interrupts = <GIC_SPI 80 IRQ_TYPE_LEVEL_LOW>;
 			clock-div = <16>;
-			clocks = <&pericfg PERI_I2C4>, <&pericfg PERI_AP_DMA>;
+			clocks = <&pericfg CLK_PERI_I2C4>, <&pericfg CLK_PERI_AP_DMA>;
 			clock-names = "main", "dma";
 		};
 
@@ -208,7 +208,7 @@
 				<0 0x11000080 0 0x80>;
 			interrupts = <GIC_SPI 82 IRQ_TYPE_LEVEL_LOW>;
 			clock-div = <16>;
-			clocks = <&pericfg PERI_I2C6>, <&pericfg PERI_AP_DMA>;
+			clocks = <&pericfg CLK_PERI_I2C6>, <&pericfg CLK_PERI_AP_DMA>;
 			clock-names = "main", "dma";
 		};
 
@@ -238,6 +238,54 @@
 			interrupts = <GIC_SPI 145 IRQ_TYPE_LEVEL_HIGH>,
 				     <GIC_SPI 146 IRQ_TYPE_LEVEL_HIGH>,
 				     <GIC_SPI 147 IRQ_TYPE_LEVEL_HIGH>;
+
+			i2c0_pins_a: i2c0@0 {
+				pins1 {
+					pinmux = <MT8173_PIN_45_SDA0__FUNC_SDA0>,
+						<MT8173_PIN_46_SCL0__FUNC_SCL0>;
+					bias-disable;
+				};
+			};
+
+			i2c1_pins_a: i2c1@0 {
+				pins1 {
+					pinmux = <MT8173_PIN_125_SDA1__FUNC_SDA1>,
+						<MT8173_PIN_126_SCL1__FUNC_SCL1>;
+					bias-disable;
+				};
+			};
+
+			i2c2_pins_a: i2c2@0 {
+				pins1 {
+					pinmux = <MT8173_PIN_43_SDA2__FUNC_SDA2>,
+						<MT8173_PIN_44_SCL2__FUNC_SCL2>;
+					bias-disable;
+				};
+			};
+
+			i2c3_pins_a: i2c3@0 {
+				pins1 {
+					pinmux = <MT8173_PIN_106_SDA3__FUNC_SDA3>,
+						<MT8173_PIN_107_SCL3__FUNC_SCL3>;
+					bias-disable;
+				};
+			};
+
+			i2c4_pins_a: i2c4@0 {
+				pins1 {
+					pinmux = <MT8173_PIN_133_SDA4__FUNC_SDA4>,
+						<MT8173_PIN_134_SCL4__FUNC_SCL4>;
+					bias-disable;
+				};
+			};
+
+			i2c6_pins_a: i2c6@0 {
+				pins1 {
+					pinmux = <MT8173_PIN_100_MSDC2_DAT0__FUNC_SDA5>,
+						<MT8173_PIN_101_MSDC2_DAT1__FUNC_SCL5>;
+					bias-disable;
+				};
+			};
 		};
 
 		scpsys: scpsys@10006000 {
diff --git a/drivers/i2c/busses/i2c-mt65xx.c b/drivers/i2c/busses/i2c-mt65xx.c
index 9d37a53..dc6635f 100644
--- a/drivers/i2c/busses/i2c-mt65xx.c
+++ b/drivers/i2c/busses/i2c-mt65xx.c
@@ -568,21 +568,21 @@ static int mtk_i2c_parse_dt(struct device_node *np, struct mtk_i2c *i2c,
 }
 
 static const struct i2c_adapter_quirks mt6577_i2c_quirks = {
-	.flags = I2C_ADAPTER_QUIRK_COMB_WRITE_THEN_READ,
+	.flags = I2C_AQ_COMB_WRITE_THEN_READ,
 	.max_num_msgs = 1,
 	.max_write_len = MAX_DMA_TRANS_SIZE_MT6577,
 	.max_read_len = MAX_DMA_TRANS_SIZE_MT6577,
-	.max_comb_write_len = MAX_DMA_TRANS_SIZE_MT6577,
-	.max_comb_read_len = MAX_WRRD_TRANS_SIZE_MT6577,
+	.max_comb_1st_msg_len = MAX_DMA_TRANS_SIZE_MT6577,
+	.max_comb_2nd_msg_len = MAX_WRRD_TRANS_SIZE_MT6577,
 };
 
 static const struct i2c_adapter_quirks mt8173_i2c_quirks = {
-	.flags = I2C_ADAPTER_QUIRK_COMB_WRITE_THEN_READ,
+	.flags = I2C_AQ_COMB_WRITE_THEN_READ,
 	.max_num_msgs = 1,
 	.max_write_len = MAX_DMA_TRANS_SIZE_MT8173,
 	.max_read_len = MAX_DMA_TRANS_SIZE_MT8173,
-	.max_comb_write_len = MAX_DMA_TRANS_SIZE_MT8173,
-	.max_comb_read_len = MAX_WRRD_TRANS_SIZE_MT8173,
+	.max_comb_1st_msg_len = MAX_DMA_TRANS_SIZE_MT8173,
+	.max_comb_2nd_msg_len = MAX_WRRD_TRANS_SIZE_MT8173,
 };
 
 static int mtk_i2c_probe(struct platform_device *pdev)
-- 
1.9.1

